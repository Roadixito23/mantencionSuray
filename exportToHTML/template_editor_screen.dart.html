<html>
<head>
<title>template_editor_screen.dart</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #bcbec4;}
.s1 { color: #6aab73;}
.s2 { color: #bcbec4;}
.s3 { color: #cf8e6d;}
.s4 { color: #7a7e85;}
.s5 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
template_editor_screen.dart</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">'package:flutter/material.dart'</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">'dart:convert'</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">'dart:io'</span><span class="s2">;</span>
<span class="s0">import </span><span class="s1">'package:path_provider/path_provider.dart'</span><span class="s2">;</span>

<span class="s3">class </span><span class="s0">TemplateEditorScreen </span><span class="s3">extends </span><span class="s0">StatefulWidget </span><span class="s2">{</span>
  <span class="s3">const </span><span class="s0">TemplateEditorScreen</span><span class="s2">({</span><span class="s0">Key</span><span class="s2">? </span><span class="s0">key</span><span class="s2">}) : </span><span class="s3">super</span><span class="s2">(</span><span class="s0">key</span><span class="s2">: </span><span class="s0">key</span><span class="s2">);</span>

  <span class="s0">@override</span>
  <span class="s0">_TemplateEditorScreenState createState</span><span class="s2">() =&gt; </span><span class="s0">_TemplateEditorScreenState</span><span class="s2">();</span>
<span class="s2">}</span>

<span class="s3">class </span><span class="s0">_TemplateEditorScreenState </span><span class="s3">extends </span><span class="s0">State</span><span class="s2">&lt;</span><span class="s0">TemplateEditorScreen</span><span class="s2">&gt; {</span>
  <span class="s3">final </span><span class="s0">_formKey </span><span class="s2">= </span><span class="s0">GlobalKey</span><span class="s2">&lt;</span><span class="s0">FormState</span><span class="s2">&gt;();</span>
  <span class="s0">List</span><span class="s2">&lt;</span><span class="s0">Map</span><span class="s2">&lt;</span><span class="s0">String</span><span class="s2">, </span><span class="s0">dynamic</span><span class="s2">&gt;&gt; </span><span class="s0">_campos </span><span class="s2">= [];</span>
  <span class="s0">bool _cargando </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

  <span class="s4">// Controlador para el nombre del nuevo campo</span>
  <span class="s3">final </span><span class="s0">TextEditingController _nombreCampoController </span><span class="s2">= </span><span class="s0">TextEditingController</span><span class="s2">();</span>

  <span class="s4">// Tipo de campo seleccionado para el nuevo campo</span>
  <span class="s0">String _tipoCampoSeleccionado </span><span class="s2">= </span><span class="s1">'Texto'</span><span class="s2">;</span>

  <span class="s4">// Indica si el campo es obligatorio</span>
  <span class="s0">bool _campoObligatorio </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>

  <span class="s0">@override</span>
  <span class="s3">void </span><span class="s0">initState</span><span class="s2">() {</span>
    <span class="s3">super</span><span class="s2">.</span><span class="s0">initState</span><span class="s2">();</span>
    <span class="s0">_cargarPlantilla</span><span class="s2">();</span>
  <span class="s2">}</span>

  <span class="s0">@override</span>
  <span class="s3">void </span><span class="s0">dispose</span><span class="s2">() {</span>
    <span class="s0">_nombreCampoController</span><span class="s2">.</span><span class="s0">dispose</span><span class="s2">();</span>
    <span class="s3">super</span><span class="s2">.</span><span class="s0">dispose</span><span class="s2">();</span>
  <span class="s2">}</span>

  <span class="s4">// Cargar la plantilla existente o crear una por defecto</span>
  <span class="s0">Future</span><span class="s2">&lt;</span><span class="s3">void</span><span class="s2">&gt; </span><span class="s0">_cargarPlantilla</span><span class="s2">() </span><span class="s0">async </span><span class="s2">{</span>
    <span class="s0">setState</span><span class="s2">(() {</span>
      <span class="s0">_cargando </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
    <span class="s2">});</span>

    <span class="s3">try </span><span class="s2">{</span>
      <span class="s3">final </span><span class="s0">file </span><span class="s2">= </span><span class="s0">await _localFile</span><span class="s2">;</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s0">await file</span><span class="s2">.</span><span class="s0">exists</span><span class="s2">()) {</span>
        <span class="s3">final </span><span class="s0">contenido </span><span class="s2">= </span><span class="s0">await file</span><span class="s2">.</span><span class="s0">readAsString</span><span class="s2">();</span>
        <span class="s3">final </span><span class="s0">List</span><span class="s2">&lt;</span><span class="s0">dynamic</span><span class="s2">&gt; </span><span class="s0">camposJson </span><span class="s2">= </span><span class="s0">jsonDecode</span><span class="s2">(</span><span class="s0">contenido</span><span class="s2">);</span>
        <span class="s0">setState</span><span class="s2">(() {</span>
          <span class="s0">_campos </span><span class="s2">= </span><span class="s0">camposJson</span><span class="s2">.</span><span class="s0">cast</span><span class="s2">&lt;</span><span class="s0">Map</span><span class="s2">&lt;</span><span class="s0">String</span><span class="s2">, </span><span class="s0">dynamic</span><span class="s2">&gt;&gt;();</span>
        <span class="s2">});</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s4">// Crear campos predeterminados</span>
        <span class="s0">setState</span><span class="s2">(() {</span>
          <span class="s0">_campos </span><span class="s2">= [</span>
            <span class="s2">{</span>
              <span class="s1">'id'</span><span class="s2">: </span><span class="s1">'maquina'</span><span class="s2">,</span>
              <span class="s1">'nombre'</span><span class="s2">: </span><span class="s1">'N°Maquina'</span><span class="s2">,</span>
              <span class="s1">'tipo'</span><span class="s2">: </span><span class="s1">'Texto'</span><span class="s2">,</span>
              <span class="s1">'obligatorio'</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
              <span class="s1">'orden'</span><span class="s2">: </span><span class="s5">0</span><span class="s2">,</span>
            <span class="s2">},</span>
            <span class="s2">{</span>
              <span class="s1">'id'</span><span class="s2">: </span><span class="s1">'patente'</span><span class="s2">,</span>
              <span class="s1">'nombre'</span><span class="s2">: </span><span class="s1">'Patente'</span><span class="s2">,</span>
              <span class="s1">'tipo'</span><span class="s2">: </span><span class="s1">'Texto'</span><span class="s2">,</span>
              <span class="s1">'obligatorio'</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
              <span class="s1">'orden'</span><span class="s2">: </span><span class="s5">1</span><span class="s2">,</span>
            <span class="s2">},</span>
            <span class="s2">{</span>
              <span class="s1">'id'</span><span class="s2">: </span><span class="s1">'capacidad'</span><span class="s2">,</span>
              <span class="s1">'nombre'</span><span class="s2">: </span><span class="s1">'Cantidad de Pasajeros'</span><span class="s2">,</span>
              <span class="s1">'tipo'</span><span class="s2">: </span><span class="s1">'Número'</span><span class="s2">,</span>
              <span class="s1">'obligatorio'</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
              <span class="s1">'orden'</span><span class="s2">: </span><span class="s5">2</span><span class="s2">,</span>
            <span class="s2">},</span>
          <span class="s2">];</span>
        <span class="s2">});</span>
        <span class="s4">// Guardar plantilla predeterminada</span>
        <span class="s0">await _guardarPlantilla</span><span class="s2">();</span>
      <span class="s2">}</span>
    <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s0">e</span><span class="s2">) {</span>
      <span class="s0">print</span><span class="s2">(</span><span class="s1">'Error al cargar plantilla: </span><span class="s2">$</span><span class="s0">e</span><span class="s1">'</span><span class="s2">);</span>
      <span class="s4">// En caso de error, cargar campos predeterminados</span>
      <span class="s0">setState</span><span class="s2">(() {</span>
        <span class="s0">_campos </span><span class="s2">= [</span>
          <span class="s2">{</span>
            <span class="s1">'id'</span><span class="s2">: </span><span class="s1">'maquina'</span><span class="s2">,</span>
            <span class="s1">'nombre'</span><span class="s2">: </span><span class="s1">'N°Maquina'</span><span class="s2">,</span>
            <span class="s1">'tipo'</span><span class="s2">: </span><span class="s1">'Texto'</span><span class="s2">,</span>
            <span class="s1">'obligatorio'</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
            <span class="s1">'orden'</span><span class="s2">: </span><span class="s5">0</span><span class="s2">,</span>
          <span class="s2">},</span>
          <span class="s2">{</span>
            <span class="s1">'id'</span><span class="s2">: </span><span class="s1">'patente'</span><span class="s2">,</span>
            <span class="s1">'nombre'</span><span class="s2">: </span><span class="s1">'Patente'</span><span class="s2">,</span>
            <span class="s1">'tipo'</span><span class="s2">: </span><span class="s1">'Texto'</span><span class="s2">,</span>
            <span class="s1">'obligatorio'</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
            <span class="s1">'orden'</span><span class="s2">: </span><span class="s5">1</span><span class="s2">,</span>
          <span class="s2">},</span>
          <span class="s2">{</span>
            <span class="s1">'id'</span><span class="s2">: </span><span class="s1">'capacidad'</span><span class="s2">,</span>
            <span class="s1">'nombre'</span><span class="s2">: </span><span class="s1">'Cantidad de Pasajeros'</span><span class="s2">,</span>
            <span class="s1">'tipo'</span><span class="s2">: </span><span class="s1">'Número'</span><span class="s2">,</span>
            <span class="s1">'obligatorio'</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
            <span class="s1">'orden'</span><span class="s2">: </span><span class="s5">2</span><span class="s2">,</span>
          <span class="s2">},</span>
        <span class="s2">];</span>
      <span class="s2">});</span>
    <span class="s2">} </span><span class="s3">finally </span><span class="s2">{</span>
      <span class="s0">setState</span><span class="s2">(() {</span>
        <span class="s0">_cargando </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
      <span class="s2">});</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s4">// Obtener el archivo de plantilla</span>
  <span class="s0">Future</span><span class="s2">&lt;</span><span class="s0">File</span><span class="s2">&gt; </span><span class="s0">get _localFile async </span><span class="s2">{</span>
    <span class="s3">final </span><span class="s0">directory </span><span class="s2">= </span><span class="s0">await getApplicationDocumentsDirectory</span><span class="s2">();</span>
    <span class="s3">return </span><span class="s0">File</span><span class="s2">(</span><span class="s1">'</span><span class="s2">${</span><span class="s0">directory</span><span class="s2">.</span><span class="s0">path</span><span class="s2">}</span><span class="s1">/plantilla.json'</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s4">// Guardar la plantilla en el almacenamiento</span>
  <span class="s0">Future</span><span class="s2">&lt;</span><span class="s3">void</span><span class="s2">&gt; </span><span class="s0">_guardarPlantilla</span><span class="s2">() </span><span class="s0">async </span><span class="s2">{</span>
    <span class="s3">try </span><span class="s2">{</span>
      <span class="s3">final </span><span class="s0">file </span><span class="s2">= </span><span class="s0">await _localFile</span><span class="s2">;</span>
      <span class="s4">// Actualizar el orden de los campos</span>
      <span class="s3">for </span><span class="s2">(</span><span class="s0">int i </span><span class="s2">= </span><span class="s5">0</span><span class="s2">; </span><span class="s0">i </span><span class="s2">&lt; </span><span class="s0">_campos</span><span class="s2">.</span><span class="s0">length</span><span class="s2">; </span><span class="s0">i</span><span class="s2">++) {</span>
        <span class="s0">_campos</span><span class="s2">[</span><span class="s0">i</span><span class="s2">][</span><span class="s1">'orden'</span><span class="s2">] = </span><span class="s0">i</span><span class="s2">;</span>
      <span class="s2">}</span>
      <span class="s0">await file</span><span class="s2">.</span><span class="s0">writeAsString</span><span class="s2">(</span><span class="s0">jsonEncode</span><span class="s2">(</span><span class="s0">_campos</span><span class="s2">));</span>

      <span class="s0">ScaffoldMessenger</span><span class="s2">.</span><span class="s0">of</span><span class="s2">(</span><span class="s0">context</span><span class="s2">).</span><span class="s0">showSnackBar</span><span class="s2">(</span>
        <span class="s3">const </span><span class="s0">SnackBar</span><span class="s2">(</span>
          <span class="s0">content</span><span class="s2">: </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Plantilla guardada con éxito'</span><span class="s2">),</span>
          <span class="s0">backgroundColor</span><span class="s2">: </span><span class="s0">Colors</span><span class="s2">.</span><span class="s0">green</span><span class="s2">,</span>
        <span class="s2">),</span>
      <span class="s2">);</span>
    <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s0">e</span><span class="s2">) {</span>
      <span class="s0">print</span><span class="s2">(</span><span class="s1">'Error al guardar plantilla: </span><span class="s2">$</span><span class="s0">e</span><span class="s1">'</span><span class="s2">);</span>
      <span class="s0">ScaffoldMessenger</span><span class="s2">.</span><span class="s0">of</span><span class="s2">(</span><span class="s0">context</span><span class="s2">).</span><span class="s0">showSnackBar</span><span class="s2">(</span>
        <span class="s0">SnackBar</span><span class="s2">(</span>
          <span class="s0">content</span><span class="s2">: </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Error al guardar: </span><span class="s2">$</span><span class="s0">e</span><span class="s1">'</span><span class="s2">),</span>
          <span class="s0">backgroundColor</span><span class="s2">: </span><span class="s0">Colors</span><span class="s2">.</span><span class="s0">red</span><span class="s2">,</span>
        <span class="s2">),</span>
      <span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s4">// Agregar un nuevo campo a la plantilla</span>
  <span class="s3">void </span><span class="s0">_agregarCampo</span><span class="s2">() {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s0">_campos</span><span class="s2">.</span><span class="s0">length </span><span class="s2">&gt;= </span><span class="s5">23</span><span class="s2">) {</span>
      <span class="s0">ScaffoldMessenger</span><span class="s2">.</span><span class="s0">of</span><span class="s2">(</span><span class="s0">context</span><span class="s2">).</span><span class="s0">showSnackBar</span><span class="s2">(</span>
        <span class="s3">const </span><span class="s0">SnackBar</span><span class="s2">(</span>
          <span class="s0">content</span><span class="s2">: </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Has alcanzado el límite de 23 campos'</span><span class="s2">),</span>
          <span class="s0">backgroundColor</span><span class="s2">: </span><span class="s0">Colors</span><span class="s2">.</span><span class="s0">orange</span><span class="s2">,</span>
        <span class="s2">),</span>
      <span class="s2">);</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s0">_nombreCampoController</span><span class="s2">.</span><span class="s0">text</span><span class="s2">.</span><span class="s0">isEmpty</span><span class="s2">) {</span>
      <span class="s0">ScaffoldMessenger</span><span class="s2">.</span><span class="s0">of</span><span class="s2">(</span><span class="s0">context</span><span class="s2">).</span><span class="s0">showSnackBar</span><span class="s2">(</span>
        <span class="s3">const </span><span class="s0">SnackBar</span><span class="s2">(</span>
          <span class="s0">content</span><span class="s2">: </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Debes ingresar un nombre para el campo'</span><span class="s2">),</span>
          <span class="s0">backgroundColor</span><span class="s2">: </span><span class="s0">Colors</span><span class="s2">.</span><span class="s0">red</span><span class="s2">,</span>
        <span class="s2">),</span>
      <span class="s2">);</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s4">// Generar un ID único basado en el nombre</span>
    <span class="s0">String id </span><span class="s2">= </span><span class="s0">_nombreCampoController</span><span class="s2">.</span><span class="s0">text</span>
        <span class="s2">.</span><span class="s0">toLowerCase</span><span class="s2">()</span>
        <span class="s2">.</span><span class="s0">replaceAll</span><span class="s2">(</span><span class="s1">' '</span><span class="s2">, </span><span class="s1">'_'</span><span class="s2">)</span>
        <span class="s2">.</span><span class="s0">replaceAll</span><span class="s2">(</span><span class="s0">RegExp</span><span class="s2">(</span><span class="s1">r'[^a-z0-9_]'</span><span class="s2">), </span><span class="s1">''</span><span class="s2">);</span>

    <span class="s4">// Verificar si ya existe un campo con ese ID</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s0">_campos</span><span class="s2">.</span><span class="s0">any</span><span class="s2">((</span><span class="s0">campo</span><span class="s2">) =&gt; </span><span class="s0">campo</span><span class="s2">[</span><span class="s1">'id'</span><span class="s2">] == </span><span class="s0">id</span><span class="s2">)) {</span>
      <span class="s4">// Agregar un sufijo numérico para hacerlo único</span>
      <span class="s0">int sufijo </span><span class="s2">= </span><span class="s5">1</span><span class="s2">;</span>
      <span class="s3">while </span><span class="s2">(</span><span class="s0">_campos</span><span class="s2">.</span><span class="s0">any</span><span class="s2">((</span><span class="s0">campo</span><span class="s2">) =&gt; </span><span class="s0">campo</span><span class="s2">[</span><span class="s1">'id'</span><span class="s2">] == </span><span class="s1">'</span><span class="s2">${</span><span class="s0">id</span><span class="s2">}</span><span class="s1">_</span><span class="s2">$</span><span class="s0">sufijo</span><span class="s1">'</span><span class="s2">)) {</span>
        <span class="s0">sufijo</span><span class="s2">++;</span>
      <span class="s2">}</span>
      <span class="s0">id </span><span class="s2">= </span><span class="s1">'</span><span class="s2">${</span><span class="s0">id</span><span class="s2">}</span><span class="s1">_</span><span class="s2">$</span><span class="s0">sufijo</span><span class="s1">'</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">setState</span><span class="s2">(() {</span>
      <span class="s0">_campos</span><span class="s2">.</span><span class="s0">add</span><span class="s2">({</span>
        <span class="s1">'id'</span><span class="s2">: </span><span class="s0">id</span><span class="s2">,</span>
        <span class="s1">'nombre'</span><span class="s2">: </span><span class="s0">_nombreCampoController</span><span class="s2">.</span><span class="s0">text</span><span class="s2">,</span>
        <span class="s1">'tipo'</span><span class="s2">: </span><span class="s0">_tipoCampoSeleccionado</span><span class="s2">,</span>
        <span class="s1">'obligatorio'</span><span class="s2">: </span><span class="s0">_campoObligatorio</span><span class="s2">,</span>
        <span class="s1">'orden'</span><span class="s2">: </span><span class="s0">_campos</span><span class="s2">.</span><span class="s0">length</span><span class="s2">,</span>
      <span class="s2">});</span>

      <span class="s4">// Limpiar controles</span>
      <span class="s0">_nombreCampoController</span><span class="s2">.</span><span class="s0">clear</span><span class="s2">();</span>
      <span class="s0">_tipoCampoSeleccionado </span><span class="s2">= </span><span class="s1">'Texto'</span><span class="s2">;</span>
      <span class="s0">_campoObligatorio </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
    <span class="s2">});</span>
  <span class="s2">}</span>

  <span class="s4">// Editar un campo existente</span>
  <span class="s3">void </span><span class="s0">_editarCampo</span><span class="s2">(</span><span class="s0">int index</span><span class="s2">) {</span>
    <span class="s3">final </span><span class="s0">campo </span><span class="s2">= </span><span class="s0">_campos</span><span class="s2">[</span><span class="s0">index</span><span class="s2">];</span>

    <span class="s0">TextEditingController editNombreController </span><span class="s2">= </span><span class="s0">TextEditingController</span><span class="s2">(</span><span class="s0">text</span><span class="s2">: </span><span class="s0">campo</span><span class="s2">[</span><span class="s1">'nombre'</span><span class="s2">]);</span>
    <span class="s0">String editTipoCampo </span><span class="s2">= </span><span class="s0">campo</span><span class="s2">[</span><span class="s1">'tipo'</span><span class="s2">];</span>
    <span class="s0">bool editObligatorio </span><span class="s2">= </span><span class="s0">campo</span><span class="s2">[</span><span class="s1">'obligatorio'</span><span class="s2">];</span>

    <span class="s0">showDialog</span><span class="s2">(</span>
      <span class="s0">context</span><span class="s2">: </span><span class="s0">context</span><span class="s2">,</span>
      <span class="s0">builder</span><span class="s2">: (</span><span class="s0">context</span><span class="s2">) =&gt; </span><span class="s0">AlertDialog</span><span class="s2">(</span>
        <span class="s0">title</span><span class="s2">: </span><span class="s3">const </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Editar Campo'</span><span class="s2">),</span>
        <span class="s0">content</span><span class="s2">: </span><span class="s0">SingleChildScrollView</span><span class="s2">(</span>
          <span class="s0">child</span><span class="s2">: </span><span class="s0">Column</span><span class="s2">(</span>
            <span class="s0">mainAxisSize</span><span class="s2">: </span><span class="s0">MainAxisSize</span><span class="s2">.</span><span class="s0">min</span><span class="s2">,</span>
            <span class="s0">children</span><span class="s2">: [</span>
              <span class="s0">TextField</span><span class="s2">(</span>
                <span class="s0">controller</span><span class="s2">: </span><span class="s0">editNombreController</span><span class="s2">,</span>
                <span class="s0">decoration</span><span class="s2">: </span><span class="s3">const </span><span class="s0">InputDecoration</span><span class="s2">(</span>
                  <span class="s0">labelText</span><span class="s2">: </span><span class="s1">'Nombre del Campo'</span><span class="s2">,</span>
                  <span class="s0">border</span><span class="s2">: </span><span class="s0">OutlineInputBorder</span><span class="s2">(),</span>
                <span class="s2">),</span>
              <span class="s2">),</span>
              <span class="s3">const </span><span class="s0">SizedBox</span><span class="s2">(</span><span class="s0">height</span><span class="s2">: </span><span class="s5">16</span><span class="s2">),</span>
              <span class="s0">DropdownButtonFormField</span><span class="s2">&lt;</span><span class="s0">String</span><span class="s2">&gt;(</span>
                <span class="s0">value</span><span class="s2">: </span><span class="s0">editTipoCampo</span><span class="s2">,</span>
                <span class="s0">decoration</span><span class="s2">: </span><span class="s3">const </span><span class="s0">InputDecoration</span><span class="s2">(</span>
                  <span class="s0">labelText</span><span class="s2">: </span><span class="s1">'Tipo de Campo'</span><span class="s2">,</span>
                  <span class="s0">border</span><span class="s2">: </span><span class="s0">OutlineInputBorder</span><span class="s2">(),</span>
                <span class="s2">),</span>
                <span class="s0">items</span><span class="s2">: </span><span class="s3">const </span><span class="s2">[</span>
                  <span class="s0">DropdownMenuItem</span><span class="s2">(</span><span class="s0">value</span><span class="s2">: </span><span class="s1">'Texto'</span><span class="s2">, </span><span class="s0">child</span><span class="s2">: </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Texto'</span><span class="s2">)),</span>
                  <span class="s0">DropdownMenuItem</span><span class="s2">(</span><span class="s0">value</span><span class="s2">: </span><span class="s1">'Número'</span><span class="s2">, </span><span class="s0">child</span><span class="s2">: </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Número'</span><span class="s2">)),</span>
                  <span class="s0">DropdownMenuItem</span><span class="s2">(</span><span class="s0">value</span><span class="s2">: </span><span class="s1">'Fecha'</span><span class="s2">, </span><span class="s0">child</span><span class="s2">: </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Fecha'</span><span class="s2">)),</span>
                  <span class="s0">DropdownMenuItem</span><span class="s2">(</span><span class="s0">value</span><span class="s2">: </span><span class="s1">'Booleano'</span><span class="s2">, </span><span class="s0">child</span><span class="s2">: </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Sí/No'</span><span class="s2">)),</span>
                <span class="s2">],</span>
                <span class="s0">onChanged</span><span class="s2">: (</span><span class="s0">value</span><span class="s2">) {</span>
                  <span class="s3">if </span><span class="s2">(</span><span class="s0">value </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
                    <span class="s0">editTipoCampo </span><span class="s2">= </span><span class="s0">value</span><span class="s2">;</span>
                  <span class="s2">}</span>
                <span class="s2">},</span>
              <span class="s2">),</span>
              <span class="s3">const </span><span class="s0">SizedBox</span><span class="s2">(</span><span class="s0">height</span><span class="s2">: </span><span class="s5">16</span><span class="s2">),</span>
              <span class="s0">CheckboxListTile</span><span class="s2">(</span>
                <span class="s0">title</span><span class="s2">: </span><span class="s3">const </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Campo Obligatorio'</span><span class="s2">),</span>
                <span class="s0">value</span><span class="s2">: </span><span class="s0">editObligatorio</span><span class="s2">,</span>
                <span class="s0">onChanged</span><span class="s2">: (</span><span class="s0">value</span><span class="s2">) {</span>
                  <span class="s3">if </span><span class="s2">(</span><span class="s0">value </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
                    <span class="s0">editObligatorio </span><span class="s2">= </span><span class="s0">value</span><span class="s2">;</span>
                  <span class="s2">}</span>
                <span class="s2">},</span>
              <span class="s2">),</span>
            <span class="s2">],</span>
          <span class="s2">),</span>
        <span class="s2">),</span>
        <span class="s0">actions</span><span class="s2">: [</span>
          <span class="s0">TextButton</span><span class="s2">(</span>
            <span class="s0">onPressed</span><span class="s2">: () =&gt; </span><span class="s0">Navigator</span><span class="s2">.</span><span class="s0">pop</span><span class="s2">(</span><span class="s0">context</span><span class="s2">),</span>
            <span class="s0">child</span><span class="s2">: </span><span class="s3">const </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Cancelar'</span><span class="s2">),</span>
          <span class="s2">),</span>
          <span class="s0">ElevatedButton</span><span class="s2">(</span>
            <span class="s0">onPressed</span><span class="s2">: () {</span>
              <span class="s3">if </span><span class="s2">(</span><span class="s0">editNombreController</span><span class="s2">.</span><span class="s0">text</span><span class="s2">.</span><span class="s0">isEmpty</span><span class="s2">) {</span>
                <span class="s0">ScaffoldMessenger</span><span class="s2">.</span><span class="s0">of</span><span class="s2">(</span><span class="s0">context</span><span class="s2">).</span><span class="s0">showSnackBar</span><span class="s2">(</span>
                  <span class="s3">const </span><span class="s0">SnackBar</span><span class="s2">(</span>
                    <span class="s0">content</span><span class="s2">: </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'El nombre no puede estar vacío'</span><span class="s2">),</span>
                    <span class="s0">backgroundColor</span><span class="s2">: </span><span class="s0">Colors</span><span class="s2">.</span><span class="s0">red</span><span class="s2">,</span>
                  <span class="s2">),</span>
                <span class="s2">);</span>
                <span class="s3">return</span><span class="s2">;</span>
              <span class="s2">}</span>

              <span class="s0">setState</span><span class="s2">(() {</span>
                <span class="s0">_campos</span><span class="s2">[</span><span class="s0">index</span><span class="s2">][</span><span class="s1">'nombre'</span><span class="s2">] = </span><span class="s0">editNombreController</span><span class="s2">.</span><span class="s0">text</span><span class="s2">;</span>
                <span class="s0">_campos</span><span class="s2">[</span><span class="s0">index</span><span class="s2">][</span><span class="s1">'tipo'</span><span class="s2">] = </span><span class="s0">editTipoCampo</span><span class="s2">;</span>
                <span class="s0">_campos</span><span class="s2">[</span><span class="s0">index</span><span class="s2">][</span><span class="s1">'obligatorio'</span><span class="s2">] = </span><span class="s0">editObligatorio</span><span class="s2">;</span>
              <span class="s2">});</span>

              <span class="s0">Navigator</span><span class="s2">.</span><span class="s0">pop</span><span class="s2">(</span><span class="s0">context</span><span class="s2">);</span>
            <span class="s2">},</span>
            <span class="s0">child</span><span class="s2">: </span><span class="s3">const </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Guardar'</span><span class="s2">),</span>
          <span class="s2">),</span>
        <span class="s2">],</span>
      <span class="s2">),</span>
    <span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s4">// Eliminar un campo</span>
  <span class="s3">void </span><span class="s0">_eliminarCampo</span><span class="s2">(</span><span class="s0">int index</span><span class="s2">) {</span>
    <span class="s3">final </span><span class="s0">campo </span><span class="s2">= </span><span class="s0">_campos</span><span class="s2">[</span><span class="s0">index</span><span class="s2">];</span>

    <span class="s4">// Mostrar confirmación antes de eliminar</span>
    <span class="s0">showDialog</span><span class="s2">(</span>
      <span class="s0">context</span><span class="s2">: </span><span class="s0">context</span><span class="s2">,</span>
      <span class="s0">builder</span><span class="s2">: (</span><span class="s0">context</span><span class="s2">) =&gt; </span><span class="s0">AlertDialog</span><span class="s2">(</span>
        <span class="s0">title</span><span class="s2">: </span><span class="s3">const </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Eliminar Campo'</span><span class="s2">),</span>
        <span class="s0">content</span><span class="s2">: </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'¿Estás seguro de que deseas eliminar el campo &quot;</span><span class="s2">${</span><span class="s0">campo</span><span class="s2">[</span><span class="s1">'nombre'</span><span class="s2">]}</span><span class="s1">&quot;?'</span><span class="s2">),</span>
        <span class="s0">actions</span><span class="s2">: [</span>
          <span class="s0">TextButton</span><span class="s2">(</span>
            <span class="s0">onPressed</span><span class="s2">: () =&gt; </span><span class="s0">Navigator</span><span class="s2">.</span><span class="s0">pop</span><span class="s2">(</span><span class="s0">context</span><span class="s2">),</span>
            <span class="s0">child</span><span class="s2">: </span><span class="s3">const </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Cancelar'</span><span class="s2">),</span>
          <span class="s2">),</span>
          <span class="s0">ElevatedButton</span><span class="s2">(</span>
            <span class="s0">style</span><span class="s2">: </span><span class="s0">ElevatedButton</span><span class="s2">.</span><span class="s0">styleFrom</span><span class="s2">(</span><span class="s0">backgroundColor</span><span class="s2">: </span><span class="s0">Colors</span><span class="s2">.</span><span class="s0">red</span><span class="s2">),</span>
            <span class="s0">onPressed</span><span class="s2">: () {</span>
              <span class="s0">setState</span><span class="s2">(() {</span>
                <span class="s0">_campos</span><span class="s2">.</span><span class="s0">removeAt</span><span class="s2">(</span><span class="s0">index</span><span class="s2">);</span>
              <span class="s2">});</span>
              <span class="s0">Navigator</span><span class="s2">.</span><span class="s0">pop</span><span class="s2">(</span><span class="s0">context</span><span class="s2">);</span>
            <span class="s2">},</span>
            <span class="s0">child</span><span class="s2">: </span><span class="s3">const </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Eliminar'</span><span class="s2">, </span><span class="s0">style</span><span class="s2">: </span><span class="s0">TextStyle</span><span class="s2">(</span><span class="s0">color</span><span class="s2">: </span><span class="s0">Colors</span><span class="s2">.</span><span class="s0">white</span><span class="s2">)),</span>
          <span class="s2">),</span>
        <span class="s2">],</span>
      <span class="s2">),</span>
    <span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s4">// Mover un campo hacia arriba en la lista</span>
  <span class="s3">void </span><span class="s0">_moverArriba</span><span class="s2">(</span><span class="s0">int index</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s0">index </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">) {</span>
      <span class="s0">setState</span><span class="s2">(() {</span>
        <span class="s3">final </span><span class="s0">campo </span><span class="s2">= </span><span class="s0">_campos</span><span class="s2">.</span><span class="s0">removeAt</span><span class="s2">(</span><span class="s0">index</span><span class="s2">);</span>
        <span class="s0">_campos</span><span class="s2">.</span><span class="s0">insert</span><span class="s2">(</span><span class="s0">index </span><span class="s2">- </span><span class="s5">1</span><span class="s2">, </span><span class="s0">campo</span><span class="s2">);</span>
      <span class="s2">});</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s4">// Mover un campo hacia abajo en la lista</span>
  <span class="s3">void </span><span class="s0">_moverAbajo</span><span class="s2">(</span><span class="s0">int index</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s0">index </span><span class="s2">&lt; </span><span class="s0">_campos</span><span class="s2">.</span><span class="s0">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">) {</span>
      <span class="s0">setState</span><span class="s2">(() {</span>
        <span class="s3">final </span><span class="s0">campo </span><span class="s2">= </span><span class="s0">_campos</span><span class="s2">.</span><span class="s0">removeAt</span><span class="s2">(</span><span class="s0">index</span><span class="s2">);</span>
        <span class="s0">_campos</span><span class="s2">.</span><span class="s0">insert</span><span class="s2">(</span><span class="s0">index </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">, </span><span class="s0">campo</span><span class="s2">);</span>
      <span class="s2">});</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s0">@override</span>
  <span class="s0">Widget build</span><span class="s2">(</span><span class="s0">BuildContext context</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s0">Scaffold</span><span class="s2">(</span>
      <span class="s0">appBar</span><span class="s2">: </span><span class="s0">AppBar</span><span class="s2">(</span>
        <span class="s0">title</span><span class="s2">: </span><span class="s3">const </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Editar Plantilla'</span><span class="s2">),</span>
        <span class="s0">centerTitle</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
        <span class="s0">actions</span><span class="s2">: [</span>
          <span class="s0">IconButton</span><span class="s2">(</span>
            <span class="s0">icon</span><span class="s2">: </span><span class="s3">const </span><span class="s0">Icon</span><span class="s2">(</span><span class="s0">Icons</span><span class="s2">.</span><span class="s0">save</span><span class="s2">),</span>
            <span class="s0">tooltip</span><span class="s2">: </span><span class="s1">'Guardar Plantilla'</span><span class="s2">,</span>
            <span class="s0">onPressed</span><span class="s2">: </span><span class="s0">_guardarPlantilla</span><span class="s2">,</span>
          <span class="s2">),</span>
        <span class="s2">],</span>
      <span class="s2">),</span>
      <span class="s0">body</span><span class="s2">: </span><span class="s0">_cargando</span>
          <span class="s2">? </span><span class="s3">const </span><span class="s0">Center</span><span class="s2">(</span><span class="s0">child</span><span class="s2">: </span><span class="s0">CircularProgressIndicator</span><span class="s2">())</span>
          <span class="s2">: </span><span class="s0">Column</span><span class="s2">(</span>
        <span class="s0">children</span><span class="s2">: [</span>
          <span class="s4">// Información sobre la plantilla</span>
          <span class="s0">Container</span><span class="s2">(</span>
            <span class="s0">padding</span><span class="s2">: </span><span class="s3">const </span><span class="s0">EdgeInsets</span><span class="s2">.</span><span class="s0">all</span><span class="s2">(</span><span class="s5">16</span><span class="s2">),</span>
            <span class="s0">color</span><span class="s2">: </span><span class="s0">Colors</span><span class="s2">.</span><span class="s0">blue</span><span class="s2">.</span><span class="s0">shade50</span><span class="s2">,</span>
            <span class="s0">child</span><span class="s2">: </span><span class="s0">Column</span><span class="s2">(</span>
              <span class="s0">crossAxisAlignment</span><span class="s2">: </span><span class="s0">CrossAxisAlignment</span><span class="s2">.</span><span class="s0">start</span><span class="s2">,</span>
              <span class="s0">children</span><span class="s2">: [</span>
                <span class="s3">const </span><span class="s0">Text</span><span class="s2">(</span>
                  <span class="s1">'Configuración de Plantilla'</span><span class="s2">,</span>
                  <span class="s0">style</span><span class="s2">: </span><span class="s0">TextStyle</span><span class="s2">(</span>
                    <span class="s0">fontSize</span><span class="s2">: </span><span class="s5">18</span><span class="s2">,</span>
                    <span class="s0">fontWeight</span><span class="s2">: </span><span class="s0">FontWeight</span><span class="s2">.</span><span class="s0">bold</span><span class="s2">,</span>
                  <span class="s2">),</span>
                <span class="s2">),</span>
                <span class="s3">const </span><span class="s0">SizedBox</span><span class="s2">(</span><span class="s0">height</span><span class="s2">: </span><span class="s5">8</span><span class="s2">),</span>
                <span class="s0">Text</span><span class="s2">(</span>
                  <span class="s1">'Campos actuales: </span><span class="s2">${</span><span class="s0">_campos</span><span class="s2">.</span><span class="s0">length</span><span class="s2">}</span><span class="s1">/23'</span><span class="s2">,</span>
                  <span class="s0">style</span><span class="s2">: </span><span class="s0">TextStyle</span><span class="s2">(</span>
                    <span class="s0">color</span><span class="s2">: </span><span class="s0">_campos</span><span class="s2">.</span><span class="s0">length </span><span class="s2">&gt;= </span><span class="s5">23 </span><span class="s2">? </span><span class="s0">Colors</span><span class="s2">.</span><span class="s0">red </span><span class="s2">: </span><span class="s0">Colors</span><span class="s2">.</span><span class="s0">grey</span><span class="s2">.</span><span class="s0">shade700</span><span class="s2">,</span>
                  <span class="s2">),</span>
                <span class="s2">),</span>
                <span class="s3">const </span><span class="s0">SizedBox</span><span class="s2">(</span><span class="s0">height</span><span class="s2">: </span><span class="s5">8</span><span class="s2">),</span>
                <span class="s3">const </span><span class="s0">Text</span><span class="s2">(</span>
                  <span class="s1">'Arrastra los campos para reordenarlos. Los campos con * son obligatorios.'</span><span class="s2">,</span>
                  <span class="s0">style</span><span class="s2">: </span><span class="s0">TextStyle</span><span class="s2">(</span>
                    <span class="s0">fontSize</span><span class="s2">: </span><span class="s5">12</span><span class="s2">,</span>
                    <span class="s0">fontStyle</span><span class="s2">: </span><span class="s0">FontStyle</span><span class="s2">.</span><span class="s0">italic</span><span class="s2">,</span>
                  <span class="s2">),</span>
                <span class="s2">),</span>
              <span class="s2">],</span>
            <span class="s2">),</span>
          <span class="s2">),</span>

          <span class="s4">// Formulario para agregar nuevos campos</span>
          <span class="s0">Padding</span><span class="s2">(</span>
            <span class="s0">padding</span><span class="s2">: </span><span class="s3">const </span><span class="s0">EdgeInsets</span><span class="s2">.</span><span class="s0">all</span><span class="s2">(</span><span class="s5">16</span><span class="s2">),</span>
            <span class="s0">child</span><span class="s2">: </span><span class="s0">Form</span><span class="s2">(</span>
              <span class="s0">key</span><span class="s2">: </span><span class="s0">_formKey</span><span class="s2">,</span>
              <span class="s0">child</span><span class="s2">: </span><span class="s0">Row</span><span class="s2">(</span>
                <span class="s0">crossAxisAlignment</span><span class="s2">: </span><span class="s0">CrossAxisAlignment</span><span class="s2">.</span><span class="s0">start</span><span class="s2">,</span>
                <span class="s0">children</span><span class="s2">: [</span>
                  <span class="s4">// Nombre del campo</span>
                  <span class="s0">Expanded</span><span class="s2">(</span>
                    <span class="s0">flex</span><span class="s2">: </span><span class="s5">3</span><span class="s2">,</span>
                    <span class="s0">child</span><span class="s2">: </span><span class="s0">TextFormField</span><span class="s2">(</span>
                      <span class="s0">controller</span><span class="s2">: </span><span class="s0">_nombreCampoController</span><span class="s2">,</span>
                      <span class="s0">decoration</span><span class="s2">: </span><span class="s3">const </span><span class="s0">InputDecoration</span><span class="s2">(</span>
                        <span class="s0">labelText</span><span class="s2">: </span><span class="s1">'Nombre del Campo'</span><span class="s2">,</span>
                        <span class="s0">border</span><span class="s2">: </span><span class="s0">OutlineInputBorder</span><span class="s2">(),</span>
                      <span class="s2">),</span>
                      <span class="s0">validator</span><span class="s2">: (</span><span class="s0">value</span><span class="s2">) {</span>
                        <span class="s3">if </span><span class="s2">(</span><span class="s0">value </span><span class="s2">== </span><span class="s3">null </span><span class="s2">|| </span><span class="s0">value</span><span class="s2">.</span><span class="s0">isEmpty</span><span class="s2">) {</span>
                          <span class="s3">return </span><span class="s1">'Ingrese un nombre'</span><span class="s2">;</span>
                        <span class="s2">}</span>
                        <span class="s3">return null</span><span class="s2">;</span>
                      <span class="s2">},</span>
                    <span class="s2">),</span>
                  <span class="s2">),</span>
                  <span class="s3">const </span><span class="s0">SizedBox</span><span class="s2">(</span><span class="s0">width</span><span class="s2">: </span><span class="s5">8</span><span class="s2">),</span>

                  <span class="s4">// Tipo de campo</span>
                  <span class="s0">Expanded</span><span class="s2">(</span>
                    <span class="s0">flex</span><span class="s2">: </span><span class="s5">2</span><span class="s2">,</span>
                    <span class="s0">child</span><span class="s2">: </span><span class="s0">DropdownButtonFormField</span><span class="s2">&lt;</span><span class="s0">String</span><span class="s2">&gt;(</span>
                      <span class="s0">value</span><span class="s2">: </span><span class="s0">_tipoCampoSeleccionado</span><span class="s2">,</span>
                      <span class="s0">decoration</span><span class="s2">: </span><span class="s3">const </span><span class="s0">InputDecoration</span><span class="s2">(</span>
                        <span class="s0">labelText</span><span class="s2">: </span><span class="s1">'Tipo'</span><span class="s2">,</span>
                        <span class="s0">border</span><span class="s2">: </span><span class="s0">OutlineInputBorder</span><span class="s2">(),</span>
                      <span class="s2">),</span>
                      <span class="s0">items</span><span class="s2">: </span><span class="s3">const </span><span class="s2">[</span>
                        <span class="s0">DropdownMenuItem</span><span class="s2">(</span><span class="s0">value</span><span class="s2">: </span><span class="s1">'Texto'</span><span class="s2">, </span><span class="s0">child</span><span class="s2">: </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Texto'</span><span class="s2">)),</span>
                        <span class="s0">DropdownMenuItem</span><span class="s2">(</span><span class="s0">value</span><span class="s2">: </span><span class="s1">'Número'</span><span class="s2">, </span><span class="s0">child</span><span class="s2">: </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Número'</span><span class="s2">)),</span>
                        <span class="s0">DropdownMenuItem</span><span class="s2">(</span><span class="s0">value</span><span class="s2">: </span><span class="s1">'Fecha'</span><span class="s2">, </span><span class="s0">child</span><span class="s2">: </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Fecha'</span><span class="s2">)),</span>
                        <span class="s0">DropdownMenuItem</span><span class="s2">(</span><span class="s0">value</span><span class="s2">: </span><span class="s1">'Booleano'</span><span class="s2">, </span><span class="s0">child</span><span class="s2">: </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Sí/No'</span><span class="s2">)),</span>
                      <span class="s2">],</span>
                      <span class="s0">onChanged</span><span class="s2">: (</span><span class="s0">value</span><span class="s2">) {</span>
                        <span class="s3">if </span><span class="s2">(</span><span class="s0">value </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
                          <span class="s0">setState</span><span class="s2">(() {</span>
                            <span class="s0">_tipoCampoSeleccionado </span><span class="s2">= </span><span class="s0">value</span><span class="s2">;</span>
                          <span class="s2">});</span>
                        <span class="s2">}</span>
                      <span class="s2">},</span>
                    <span class="s2">),</span>
                  <span class="s2">),</span>
                  <span class="s3">const </span><span class="s0">SizedBox</span><span class="s2">(</span><span class="s0">width</span><span class="s2">: </span><span class="s5">8</span><span class="s2">),</span>

                  <span class="s4">// Campo obligatorio</span>
                  <span class="s0">Expanded</span><span class="s2">(</span>
                    <span class="s0">flex</span><span class="s2">: </span><span class="s5">2</span><span class="s2">,</span>
                    <span class="s0">child</span><span class="s2">: </span><span class="s0">CheckboxListTile</span><span class="s2">(</span>
                      <span class="s0">title</span><span class="s2">: </span><span class="s3">const </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Obligatorio'</span><span class="s2">),</span>
                      <span class="s0">value</span><span class="s2">: </span><span class="s0">_campoObligatorio</span><span class="s2">,</span>
                      <span class="s0">onChanged</span><span class="s2">: (</span><span class="s0">value</span><span class="s2">) {</span>
                        <span class="s3">if </span><span class="s2">(</span><span class="s0">value </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
                          <span class="s0">setState</span><span class="s2">(() {</span>
                            <span class="s0">_campoObligatorio </span><span class="s2">= </span><span class="s0">value</span><span class="s2">;</span>
                          <span class="s2">});</span>
                        <span class="s2">}</span>
                      <span class="s2">},</span>
                      <span class="s0">controlAffinity</span><span class="s2">: </span><span class="s0">ListTileControlAffinity</span><span class="s2">.</span><span class="s0">leading</span><span class="s2">,</span>
                      <span class="s0">contentPadding</span><span class="s2">: </span><span class="s0">EdgeInsets</span><span class="s2">.</span><span class="s0">zero</span><span class="s2">,</span>
                    <span class="s2">),</span>
                  <span class="s2">),</span>

                  <span class="s4">// Botón para agregar</span>
                  <span class="s0">IconButton</span><span class="s2">(</span>
                    <span class="s0">icon</span><span class="s2">: </span><span class="s3">const </span><span class="s0">Icon</span><span class="s2">(</span><span class="s0">Icons</span><span class="s2">.</span><span class="s0">add_circle</span><span class="s2">),</span>
                    <span class="s0">color</span><span class="s2">: </span><span class="s0">Colors</span><span class="s2">.</span><span class="s0">green</span><span class="s2">,</span>
                    <span class="s0">onPressed</span><span class="s2">: </span><span class="s0">_campos</span><span class="s2">.</span><span class="s0">length </span><span class="s2">&lt; </span><span class="s5">23 </span><span class="s2">? </span><span class="s0">_agregarCampo </span><span class="s2">: </span><span class="s3">null</span><span class="s2">,</span>
                    <span class="s0">tooltip</span><span class="s2">: </span><span class="s1">'Agregar Campo'</span><span class="s2">,</span>
                    <span class="s0">iconSize</span><span class="s2">: </span><span class="s5">40</span><span class="s2">,</span>
                  <span class="s2">),</span>
                <span class="s2">],</span>
              <span class="s2">),</span>
            <span class="s2">),</span>
          <span class="s2">),</span>

          <span class="s4">// Lista de campos actuales</span>
          <span class="s0">Expanded</span><span class="s2">(</span>
            <span class="s0">child</span><span class="s2">: </span><span class="s0">ListView</span><span class="s2">.</span><span class="s0">builder</span><span class="s2">(</span>
              <span class="s0">itemCount</span><span class="s2">: </span><span class="s0">_campos</span><span class="s2">.</span><span class="s0">length</span><span class="s2">,</span>
              <span class="s0">itemBuilder</span><span class="s2">: (</span><span class="s0">context</span><span class="s2">, </span><span class="s0">index</span><span class="s2">) {</span>
                <span class="s3">final </span><span class="s0">campo </span><span class="s2">= </span><span class="s0">_campos</span><span class="s2">[</span><span class="s0">index</span><span class="s2">];</span>
                <span class="s3">return </span><span class="s0">Card</span><span class="s2">(</span>
                  <span class="s0">margin</span><span class="s2">: </span><span class="s3">const </span><span class="s0">EdgeInsets</span><span class="s2">.</span><span class="s0">symmetric</span><span class="s2">(</span><span class="s0">horizontal</span><span class="s2">: </span><span class="s5">16</span><span class="s2">, </span><span class="s0">vertical</span><span class="s2">: </span><span class="s5">4</span><span class="s2">),</span>
                  <span class="s0">child</span><span class="s2">: </span><span class="s0">ListTile</span><span class="s2">(</span>
                    <span class="s0">leading</span><span class="s2">: </span><span class="s0">CircleAvatar</span><span class="s2">(</span>
                      <span class="s0">backgroundColor</span><span class="s2">: </span><span class="s0">Colors</span><span class="s2">.</span><span class="s0">blue</span><span class="s2">.</span><span class="s0">shade100</span><span class="s2">,</span>
                      <span class="s0">child</span><span class="s2">: </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'</span><span class="s2">${</span><span class="s0">index </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">}</span><span class="s1">'</span><span class="s2">),</span>
                    <span class="s2">),</span>
                    <span class="s0">title</span><span class="s2">: </span><span class="s0">Text</span><span class="s2">(</span>
                      <span class="s0">campo</span><span class="s2">[</span><span class="s1">'obligatorio'</span><span class="s2">]</span>
                          <span class="s2">? </span><span class="s1">'</span><span class="s2">${</span><span class="s0">campo</span><span class="s2">[</span><span class="s1">'nombre'</span><span class="s2">]} </span><span class="s1">*'</span>
                          <span class="s2">: </span><span class="s0">campo</span><span class="s2">[</span><span class="s1">'nombre'</span><span class="s2">],</span>
                      <span class="s0">style</span><span class="s2">: </span><span class="s3">const </span><span class="s0">TextStyle</span><span class="s2">(</span><span class="s0">fontWeight</span><span class="s2">: </span><span class="s0">FontWeight</span><span class="s2">.</span><span class="s0">bold</span><span class="s2">),</span>
                    <span class="s2">),</span>
                    <span class="s0">subtitle</span><span class="s2">: </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Tipo: </span><span class="s2">${</span><span class="s0">campo</span><span class="s2">[</span><span class="s1">'tipo'</span><span class="s2">]} </span><span class="s1">- ID: </span><span class="s2">${</span><span class="s0">campo</span><span class="s2">[</span><span class="s1">'id'</span><span class="s2">]}</span><span class="s1">'</span><span class="s2">),</span>
                    <span class="s0">trailing</span><span class="s2">: </span><span class="s0">Row</span><span class="s2">(</span>
                      <span class="s0">mainAxisSize</span><span class="s2">: </span><span class="s0">MainAxisSize</span><span class="s2">.</span><span class="s0">min</span><span class="s2">,</span>
                      <span class="s0">children</span><span class="s2">: [</span>
                        <span class="s4">// Botón para mover arriba</span>
                        <span class="s0">IconButton</span><span class="s2">(</span>
                          <span class="s0">icon</span><span class="s2">: </span><span class="s3">const </span><span class="s0">Icon</span><span class="s2">(</span><span class="s0">Icons</span><span class="s2">.</span><span class="s0">arrow_upward</span><span class="s2">),</span>
                          <span class="s0">onPressed</span><span class="s2">: </span><span class="s0">index </span><span class="s2">&gt; </span><span class="s5">0 </span><span class="s2">? () =&gt; </span><span class="s0">_moverArriba</span><span class="s2">(</span><span class="s0">index</span><span class="s2">) : </span><span class="s3">null</span><span class="s2">,</span>
                          <span class="s0">tooltip</span><span class="s2">: </span><span class="s1">'Mover Arriba'</span><span class="s2">,</span>
                        <span class="s2">),</span>
                        <span class="s4">// Botón para mover abajo</span>
                        <span class="s0">IconButton</span><span class="s2">(</span>
                          <span class="s0">icon</span><span class="s2">: </span><span class="s3">const </span><span class="s0">Icon</span><span class="s2">(</span><span class="s0">Icons</span><span class="s2">.</span><span class="s0">arrow_downward</span><span class="s2">),</span>
                          <span class="s0">onPressed</span><span class="s2">: </span><span class="s0">index </span><span class="s2">&lt; </span><span class="s0">_campos</span><span class="s2">.</span><span class="s0">length </span><span class="s2">- </span><span class="s5">1</span>
                              <span class="s2">? () =&gt; </span><span class="s0">_moverAbajo</span><span class="s2">(</span><span class="s0">index</span><span class="s2">)</span>
                              <span class="s2">: </span><span class="s3">null</span><span class="s2">,</span>
                          <span class="s0">tooltip</span><span class="s2">: </span><span class="s1">'Mover Abajo'</span><span class="s2">,</span>
                        <span class="s2">),</span>
                        <span class="s4">// Botón para editar</span>
                        <span class="s0">IconButton</span><span class="s2">(</span>
                          <span class="s0">icon</span><span class="s2">: </span><span class="s3">const </span><span class="s0">Icon</span><span class="s2">(</span><span class="s0">Icons</span><span class="s2">.</span><span class="s0">edit</span><span class="s2">),</span>
                          <span class="s0">onPressed</span><span class="s2">: () =&gt; </span><span class="s0">_editarCampo</span><span class="s2">(</span><span class="s0">index</span><span class="s2">),</span>
                          <span class="s0">tooltip</span><span class="s2">: </span><span class="s1">'Editar Campo'</span><span class="s2">,</span>
                        <span class="s2">),</span>
                        <span class="s4">// Botón para eliminar</span>
                        <span class="s0">IconButton</span><span class="s2">(</span>
                          <span class="s0">icon</span><span class="s2">: </span><span class="s3">const </span><span class="s0">Icon</span><span class="s2">(</span><span class="s0">Icons</span><span class="s2">.</span><span class="s0">delete</span><span class="s2">, </span><span class="s0">color</span><span class="s2">: </span><span class="s0">Colors</span><span class="s2">.</span><span class="s0">red</span><span class="s2">),</span>
                          <span class="s0">onPressed</span><span class="s2">: () =&gt; </span><span class="s0">_eliminarCampo</span><span class="s2">(</span><span class="s0">index</span><span class="s2">),</span>
                          <span class="s0">tooltip</span><span class="s2">: </span><span class="s1">'Eliminar Campo'</span><span class="s2">,</span>
                        <span class="s2">),</span>
                      <span class="s2">],</span>
                    <span class="s2">),</span>
                  <span class="s2">),</span>
                <span class="s2">);</span>
              <span class="s2">},</span>
            <span class="s2">),</span>
          <span class="s2">),</span>
        <span class="s2">],</span>
      <span class="s2">),</span>
      <span class="s0">bottomNavigationBar</span><span class="s2">: </span><span class="s0">Container</span><span class="s2">(</span>
        <span class="s0">padding</span><span class="s2">: </span><span class="s3">const </span><span class="s0">EdgeInsets</span><span class="s2">.</span><span class="s0">all</span><span class="s2">(</span><span class="s5">16</span><span class="s2">),</span>
        <span class="s0">color</span><span class="s2">: </span><span class="s0">Colors</span><span class="s2">.</span><span class="s0">grey</span><span class="s2">.</span><span class="s0">shade200</span><span class="s2">,</span>
        <span class="s0">child</span><span class="s2">: </span><span class="s0">ElevatedButton</span><span class="s2">(</span>
          <span class="s0">onPressed</span><span class="s2">: () {</span>
            <span class="s0">_guardarPlantilla</span><span class="s2">().</span><span class="s0">then</span><span class="s2">((</span><span class="s0">_</span><span class="s2">) {</span>
              <span class="s0">Navigator</span><span class="s2">.</span><span class="s0">pop</span><span class="s2">(</span><span class="s0">context</span><span class="s2">);</span>
            <span class="s2">});</span>
          <span class="s2">},</span>
          <span class="s0">style</span><span class="s2">: </span><span class="s0">ElevatedButton</span><span class="s2">.</span><span class="s0">styleFrom</span><span class="s2">(</span>
            <span class="s0">padding</span><span class="s2">: </span><span class="s3">const </span><span class="s0">EdgeInsets</span><span class="s2">.</span><span class="s0">symmetric</span><span class="s2">(</span><span class="s0">vertical</span><span class="s2">: </span><span class="s5">16</span><span class="s2">),</span>
          <span class="s2">),</span>
          <span class="s0">child</span><span class="s2">: </span><span class="s3">const </span><span class="s0">Text</span><span class="s2">(</span><span class="s1">'Guardar y Salir'</span><span class="s2">, </span><span class="s0">style</span><span class="s2">: </span><span class="s0">TextStyle</span><span class="s2">(</span><span class="s0">fontSize</span><span class="s2">: </span><span class="s5">16</span><span class="s2">)),</span>
        <span class="s2">),</span>
      <span class="s2">),</span>
    <span class="s2">);</span>
  <span class="s2">}</span>
<span class="s2">}</span></pre>
</body>
</html>